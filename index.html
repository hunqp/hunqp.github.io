<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>IPC Webadmin</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        #messages {
            border: 1px solid #ddd;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
        }
    </style>
</head>
<body>
    <button class="button" onclick="performConnect()">Connect</button>
    <h2 id="status-connection" style="font-style: italic;">Status</h2>
    <div id="messages"></div>
</body>
<script>
    const host = "wss://broker.emqx.io:8084/mqtt";
    // const host = "ws://demo.thingsboard.io:1883/mqtt";

    function setState(state) {
        document.getElementById('status-connection').textContent = state;
    }

    function performConnect() {
        setState("Trying to connect...");
 
        const client = mqtt.connect(host, 8084);

        client.on('connect', () => {
            setState("Connected");
        });

        client.on('message', (topic, message) => {
            const messageDiv = document.getElementById('messages');
            messageDiv.innerHTML += `<p><strong>${topic}:</strong> ${message.toString()}</p>`;
            messageDiv.scrollTop = messageDiv.scrollHeight;
        });

        client.on('error', (error) => {
            console.error('Connection error:', error);
            setState("Connection error");
        });

        client.on('close', () => {
            console.log('Disconnected');
            setState("Disconnected");
        });
    }
</script>
</html>

